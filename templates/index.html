<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Strumento di Sicurezza Password</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .lang-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 600;
        }
        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        .lang-btn.active {
            background: white;
            color: #4facfe;
            border-color: white;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
        }
        .tab:hover {
            background: #e9ecef;
        }
        .tab.active {
            background: white;
            color: #4facfe;
            border-bottom: 3px solid #4facfe;
        }
        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input[type="text"], input[type="password"], input[type="number"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4facfe;
        }
        .password-result {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            background: #343a40;
            color: #00f2fe;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4facfe;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }
        .copy-btn:hover {
            background: #00f2fe;
        }
        .strength-bar-container {
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .strength-bar {
            height: 100%;
            width: 0%;
            background-color: #4facfe; /* Default */
            border-radius: 5px;
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }
        .strength-bar.very-weak { background-color: #ef4444; } /* Red */
        .strength-bar.weak { background-color: #f97316; } /* Orange */
        .strength-bar.moderate { background-color: #facc15; } /* Yellow */
        .strength-bar.strong { background-color: #22c55e; } /* Green */
        .strength-bar.very-strong { background-color: #0d9488; } /* Teal */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4facfe;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-5 bg-gradient-to-br from-indigo-500 to-purple-700">
    <div class="container rounded-xl shadow-2xl">
        <div class="header">
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="it">IT</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <h1 class="text-4xl font-extrabold mb-2" data-lang-key="headerTitle">üîê Strumento di Sicurezza Password</h1>
            <p class="text-lg opacity-90" data-lang-key="headerSubtitle">Genera, analizza e controlla le tue password.</p>
        </div>

        <div class="tabs flex bg-gray-50 border-b border-gray-200">
            <button class="tab active flex-1 py-5 px-4 text-center cursor-pointer transition-all duration-300 font-semibold text-gray-700 hover:bg-gray-100 border-b-2 border-transparent" data-tab="generate" data-lang-key="tabGenerate">Genera Password</button>
            <button class="tab flex-1 py-5 px-4 text-center cursor-pointer transition-all duration-300 font-semibold text-gray-700 hover:bg-gray-100 border-b-2 border-transparent" data-tab="check-strength" data-lang-key="tabCheckStrength">Controlla Forza</button>
            <button class="tab flex-1 py-5 px-4 text-center cursor-pointer transition-all duration-300 font-semibold text-gray-700 hover:bg-gray-100 border-b-2 border-transparent" data-tab="check-breach" data-lang-key="tabCheckBreach">Controlla Violazioni</button>
        </div>

        <div id="generate" class="tab-content active p-10 bg-white">
            <h2 class="text-2xl font-bold mb-6 text-gray-800" data-lang-key="generateTitle">Genera una Password Sicura</h2>
            <div class="form-group mb-5">
                <label for="genLength" class="block text-gray-700 font-semibold mb-2" data-lang-key="genLengthLabel">Lunghezza Password (8-128):</label>
                <input type="number" id="genLength" value="16" min="8" max="128" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div class="checkbox-group flex items-center mb-4">
                <input type="checkbox" id="genSymbols" checked class="mr-2 transform scale-125 text-blue-600 rounded focus:ring-blue-500">
                <label for="genSymbols" class="text-gray-700" data-lang-key="genSymbolsLabel">Includi Simboli (!@#$%)</label>
            </div>
            <div class="checkbox-group flex items-center mb-6">
                <input type="checkbox" id="genAmbiguous" checked class="mr-2 transform scale-125 text-blue-600 rounded focus:ring-blue-500">
                <label for="genAmbiguous" class="text-gray-700" data-lang-key="genAmbiguousLabel">Escludi Caratteri Ambigui (0, O, 1, l, I, |)</label>
            </div>
            <button id="generateBtn" class="btn flex items-center justify-center" data-lang-key="generateBtn">
                Genera Password
                <span id="generateSpinner" class="loading-spinner hidden"></span>
            </button>
            <div id="generateResult" class="result mt-8 p-5 bg-blue-50 border-l-4 border-blue-400 rounded-lg text-gray-800">
                <p class="font-semibold text-lg mb-2" data-lang-key="genResultTitle">La tua password generata apparir√† qui:</p>
                <div class="password-result relative">
                    <span id="generatedPasswordText"></span>
                    <button class="copy-btn" onclick="copyToClipboard('generatedPasswordText')" data-lang-key="copyBtn">Copia</button>
                </div>
                <p class="mt-4 text-sm" data-lang-key="strengthLabelPrefix">Forza: <span id="generatedPasswordStrength"></span></p>
            </div>
        </div>

        <div id="check-strength" class="tab-content p-10 bg-white">
            <h2 class="text-2xl font-bold mb-6 text-gray-800" data-lang-key="checkStrengthTitle">Controlla la Forza della Password</h2>
            <div class="form-group mb-5">
                <label for="checkPassword" class="block text-gray-700 font-semibold mb-2" data-lang-key="checkPasswordLabel">Inserisci la password da controllare:</label>
                <input type="password" id="checkPassword" placeholder="La tua password" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-blue-500">
            </div>
            <button id="checkStrengthBtn" class="btn flex items-center justify-center" data-lang-key="checkStrengthBtn">
                Controlla Forza
                <span id="checkStrengthSpinner" class="loading-spinner hidden"></span>
            </button>
            <div id="checkStrengthResult" class="result mt-8 p-5 bg-green-50 border-l-4 border-green-400 rounded-lg text-gray-800">
                <h3 class="font-bold text-xl mb-3" data-lang-key="analysisResultsTitle">Risultati Analisi:</h3>
                <p data-lang-key="overallStrength">Forza complessiva: <span id="strengthLabel" class="font-semibold"></span> (<span id="strengthScore"></span>/100)</p>
                <div class="strength-bar-container">
                    <div id="strengthProgressBar" class="strength-bar" style="width: 0%;"></div>
                </div>
                <p class="mt-4"><span data-lang-key="lengthDetail">Lunghezza:</span> <span id="detailLength"></span> caratteri</p>
                <p><span data-lang-key="uppercaseDetail">Maiuscole:</span> <span id="detailUpper"></span></p>
                <p><span data-lang-key="lowercaseDetail">Minuscole:</span> <span id="detailLower"></span></p>
                <p><span data-lang-key="numbersDetail">Numeri:</span> <span id="detailDigits"></span></p>
                <p><span data-lang-key="symbolsDetail">Simboli:</span> <span id="detailSpecial"></span></p>
                <p><span data-lang-key="commonPasswordDetail">Password comune:</span> <span id="detailCommon"></span></p>
                <h4 class="font-bold text-lg mt-5 mb-2" data-lang-key="recommendationsTitle">Raccomandazioni:</h4>
                <ul id="recommendationsList" class="list-disc pl-5">
                    <!-- Recommendations will be loaded here -->
                </ul>
            </div>
        </div>

        <div id="check-breach" class="tab-content p-10 bg-white">
            <h2 class="text-2xl font-bold mb-6 text-gray-800" data-lang-key="checkBreachTitle">Controlla Violazioni di Dati</h2>
            <div class="form-group mb-5">
                <label for="breachPassword" class="block text-gray-700 font-semibold mb-2" data-lang-key="breachPasswordLabel">Inserisci la password da controllare:</label>
                <input type="password" id="breachPassword" placeholder="La tua password" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-blue-500">
            </div>
            <button id="checkBreachBtn" class="btn flex items-center justify-center" data-lang-key="checkBreachBtn">
                Controlla Password
                <span id="checkBreachSpinner" class="loading-spinner hidden"></span>
            </button>
            <div id="breachResult" class="result mt-8 p-5 bg-red-50 border-l-4 border-red-400 rounded-lg text-gray-800">
                <p id="breachMessage" class="font-semibold text-lg"></p>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            it: {
                headerTitle: "üîê Strumento di Sicurezza Password",
                headerSubtitle: "Genera, analizza e controlla le tue password.",
                tabGenerate: "Genera Password",
                tabCheckStrength: "Controlla Forza",
                tabCheckBreach: "Controlla Violazioni",
                generateTitle: "Genera una Password Sicura",
                genLengthLabel: "Lunghezza Password (8-128):",
                genSymbolsLabel: "Includi Simboli (!@#$%)",
                genAmbiguousLabel: "Escludi Caratteri Ambigui (0, O, 1, l, I, |)",
                generateBtn: "Genera Password",
                genResultTitle: "La tua password generata apparir√† qui:",
                copyBtn: "Copia",
                strengthLabelPrefix: "Forza:",
                checkStrengthTitle: "Controlla la Forza della Password",
                checkPasswordLabel: "Inserisci la password da controllare:",
                checkStrengthBtn: "Controlla Forza",
                analysisResultsTitle: "Risultati Analisi:",
                overallStrength: "Forza complessiva:",
                lengthDetail: "Lunghezza:",
                uppercaseDetail: "Maiuscole:",
                lowercaseDetail: "Minuscole:",
                numbersDetail: "Numeri:",
                symbolsDetail: "Simboli:",
                commonPasswordDetail: "Password comune:",
                recommendationsTitle: "Raccomandazioni:",
                excellentPassword: "üéâ Ottimo! Questa password soddisfa tutti i criteri di sicurezza.",
                checkBreachTitle: "Controlla Violazioni di Dati",
                breachPasswordLabel: "Inserisci la password da controllare:",
                checkBreachBtn: "Controlla Password",
                breachWarning: (count) => `‚ö†Ô∏è ATTENZIONE: Password trovata in ${count.toLocaleString()} violazioni di dati!`,
                breachNotFound: "‚úÖ Ottime notizie! Password non trovata in violazioni note.",
                breachApiError: "‚ùì Impossibile controllare (API non disponibile)",
                alertCopied: "Password copiata negli appunti!",
                alertEnterPasswordCheck: "Inserisci una password da controllare.",
                alertEnterPasswordBreach: "Inserisci una password da controllare per le violazioni.",
                alertGenError: (detail) => `Errore nella generazione: ${detail || 'Errore sconosciuto'}`,
                alertCheckError: (detail) => `Errore nell'analisi: ${detail || 'Errore sconosciuto'}`,
                alertConnectionError: "Errore di connessione al server. Assicurati che il backend sia in esecuzione.",
                yes: "S√¨",
                no: "No"
            },
            en: {
                headerTitle: "üîê Password Security Tool",
                headerSubtitle: "Generate, analyze, and check your passwords.",
                tabGenerate: "Generate Password",
                tabCheckStrength: "Check Strength",
                tabCheckBreach: "Check Breaches",
                generateTitle: "Generate a Secure Password",
                genLengthLabel: "Password Length (8-128):",
                genSymbolsLabel: "Include Symbols (!@#$%)",
                genAmbiguousLabel: "Exclude Ambiguous Chars (0, O, 1, l, I, |)",
                generateBtn: "Generate Password",
                genResultTitle: "Your generated password will appear here:",
                copyBtn: "Copy",
                strengthLabelPrefix: "Strength:",
                checkStrengthTitle: "Check Password Strength",
                checkPasswordLabel: "Enter password to check:",
                checkStrengthBtn: "Check Strength",
                analysisResultsTitle: "Analysis Results:",
                overallStrength: "Overall Strength:",
                lengthDetail: "Length:",
                uppercaseDetail: "Uppercase:",
                lowercaseDetail: "Lowercase:",
                numbersDetail: "Numbers:",
                symbolsDetail: "Symbols:",
                commonPasswordDetail: "Common password:",
                recommendationsTitle: "Recommendations:",
                excellentPassword: "üéâ Excellent! This password meets all security criteria.",
                checkBreachTitle: "Check Data Breaches",
                breachPasswordLabel: "Enter password to check:",
                checkBreachBtn: "Check Password",
                breachWarning: (count) => `‚ö†Ô∏è WARNING: Password found in ${count.toLocaleString()} data breaches!`,
                breachNotFound: "‚úÖ Good news! Password not found in known breaches.",
                breachApiError: "‚ùì Could not check (API unavailable)",
                alertCopied: "Password copied to clipboard!",
                alertEnterPasswordCheck: "Please enter a password to check.",
                alertEnterPasswordBreach: "Please enter a password to check for breaches.",
                alertGenError: (detail) => `Generation error: ${detail || 'Unknown error'}`,
                alertCheckError: (detail) => `Analysis error: ${detail || 'Unknown error'}`,
                alertConnectionError: "Connection error to server. Ensure backend is running.",
                yes: "Yes",
                no: "No"
            }
        };

        let currentLanguage = 'it'; // Default language

        // Funzione per copiare negli appunti
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const textToCopy = element.innerText;
            if (textToCopy) {
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert(translations[currentLanguage].alertCopied);
                } catch (err) {
                    console.error('Impossibile copiare: ', err);
                }
                document.body.removeChild(textarea);
            }
        }

        // Funzione per aggiornare la lingua dell'interfaccia
        function updateLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.dataset.langKey;
                if (translations[lang][key]) {
                    // Special handling for elements that might contain dynamic content or need innerHTML
                    if (element.tagName === 'BUTTON' || element.tagName === 'LABEL' || element.tagName === 'H1' || element.tagName === 'H2' || element.tagName === 'H3' || element.tagName === 'P' || element.tagName === 'SPAN') {
                        element.innerText = translations[lang][key];
                    }
                }
            });

            // Update active language button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Re-render any dynamic content that depends on language, e.g., strength details
            // This is important if a result is already displayed when language changes
            if (checkStrengthResultDiv.style.display === 'block') {
                updateStrengthDetails(currentLanguage);
            }
            if (breachResultDiv.style.display === 'block') {
                 // Re-evaluate breach message to update its text
                const currentBreachMessage = breachMessageP.dataset.originalMessage; // Store original message type
                if (currentBreachMessage) {
                    if (currentBreachMessage === 'breached') {
                        const count = parseInt(breachMessageP.dataset.breachCount);
                        breachMessageP.innerText = translations[currentLanguage].breachWarning(count);
                    } else if (currentBreachMessage === 'not_breached') {
                        breachMessageP.innerText = translations[currentLanguage].breachNotFound;
                    } else if (currentBreachMessage === 'api_error') {
                        breachMessageP.innerText = translations[currentLanguage].breachApiError;
                    }
                }
            }
        }

        // Helper function to update strength details (used for initial display and language change)
        function updateStrengthDetails(lang) {
            const stats = checkStrengthResultDiv.dataset.stats ? JSON.parse(checkStrengthResultDiv.dataset.stats) : null;
            const recommendations = checkStrengthResultDiv.dataset.recommendations ? JSON.parse(checkStrengthResultDiv.dataset.recommendations) : null;

            if (stats) {
                strengthLabelSpan.innerText = stats.strength_label;
                strengthScoreSpan.innerText = stats.strength_score;

                strengthProgressBar.style.width = `${stats.strength_score}%`;
                strengthProgressBar.className = 'strength-bar';
                if (stats.strength_label === 'Very Weak') strengthProgressBar.classList.add('very-weak');
                else if (stats.strength_label === 'Weak') strengthProgressBar.classList.add('weak');
                else if (stats.strength_label === 'Moderate') strengthProgressBar.classList.add('moderate');
                else if (stats.strength_label === 'Strong') strengthProgressBar.classList.add('strong');
                else if (stats.strength_label === 'Very Strong') strengthProgressBar.classList.add('very-strong');

                detailLengthSpan.innerText = stats.length;
                detailUpperSpan.innerHTML = stats.has_upper ? `‚úÖ ${translations[lang].yes}` : `‚ùå ${translations[lang].no}`;
                detailLowerSpan.innerHTML = stats.has_lower ? `‚úÖ ${translations[lang].yes}` : `‚ùå ${translations[lang].no}`;
                detailDigitsSpan.innerHTML = stats.has_digits ? `‚úÖ ${translations[lang].yes}` : `‚ùå ${translations[lang].no}`;
                detailSpecialSpan.innerHTML = stats.has_special ? `‚úÖ ${translations[lang].yes}` : `‚ùå ${translations[lang].no}`;
                detailCommonSpan.innerHTML = stats.is_common ? `‚ö†Ô∏è ${translations[lang].yes}` : `‚úÖ ${translations[lang].no}`;

                recommendationsList.innerHTML = '';
                if (recommendations && recommendations.length > 0) {
                    recommendations.forEach(rec => {
                        const li = document.createElement('li');
                        li.innerText = rec;
                        recommendationsList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.innerText = translations[lang].excellentPassword;
                    recommendationsList.appendChild(li);
                }
            }
        }


        // Gestione delle schede
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active', 'border-blue-500'));
                tabContents.forEach(tc => tc.classList.remove('active'));

                tab.classList.add('active', 'border-blue-500');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Funzione helper per mostrare/nascondere spinner
        function toggleSpinner(spinnerId, show) {
            document.getElementById(spinnerId).classList.toggle('hidden', !show);
        }

        // --- Funzionalit√† Genera Password ---
        const generateBtn = document.getElementById('generateBtn');
        const genLengthInput = document.getElementById('genLength');
        const genSymbolsCheckbox = document.getElementById('genSymbols');
        const genAmbiguousCheckbox = document.getElementById('genAmbiguous');
        const generatedPasswordText = document.getElementById('generatedPasswordText');
        const generatedPasswordStrength = document.getElementById('generatedPasswordStrength');
        const generateResultDiv = document.getElementById('generateResult');

        generateResultDiv.style.display = 'none'; // Nascondi i risultati inizialmente

        generateBtn.addEventListener('click', async () => {
            const length = parseInt(genLengthInput.value);
            const includeSymbols = genSymbolsCheckbox.checked;
            const excludeAmbiguous = genAmbiguousCheckbox.checked;

            toggleSpinner('generateSpinner', true);
            generateResultDiv.style.display = 'none'; // Nascondi i risultati precedenti

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ length, include_symbols: includeSymbols, exclude_ambiguous: excludeAmbiguous })
                });

                const data = await response.json();

                if (response.ok) {
                    generatedPasswordText.innerText = data.password;
                    generatedPasswordStrength.innerText = `${data.strength_label} (${data.strength_score}/100)`;
                    generateResultDiv.style.display = 'block';
                } else {
                    alert(translations[currentLanguage].alertGenError(data.detail));
                }
            } catch (error) {
                console.error('Errore di rete o parsing:', error);
                alert(translations[currentLanguage].alertConnectionError);
            } finally {
                toggleSpinner('generateSpinner', false);
            }
        });

        // --- Funzionalit√† Controlla Forza ---
        const checkStrengthBtn = document.getElementById('checkStrengthBtn');
        const checkPasswordInput = document.getElementById('checkPassword');
        const checkStrengthResultDiv = document.getElementById('checkStrengthResult');
        const strengthLabelSpan = document.getElementById('strengthLabel');
        const strengthScoreSpan = document.getElementById('strengthScore');
        const strengthProgressBar = document.getElementById('strengthProgressBar');
        const detailLengthSpan = document.getElementById('detailLength');
        const detailUpperSpan = document.getElementById('detailUpper');
        const detailLowerSpan = document.getElementById('detailLower');
        const detailDigitsSpan = document.getElementById('detailDigits');
        const detailSpecialSpan = document.getElementById('detailSpecial');
        const detailCommonSpan = document.getElementById('detailCommon');
        const recommendationsList = document.getElementById('recommendationsList');

        checkStrengthResultDiv.style.display = 'none'; // Nascondi i risultati inizialmente

        checkStrengthBtn.addEventListener('click', async () => {
            const password = checkPasswordInput.value;
            if (!password) {
                alert(translations[currentLanguage].alertEnterPasswordCheck);
                return;
            }

            toggleSpinner('checkStrengthSpinner', true);
            checkStrengthResultDiv.style.display = 'none'; // Nascondi i risultati precedenti

            try {
                const response = await fetch('/api/check', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Store data in dataset for language switching
                    checkStrengthResultDiv.dataset.stats = JSON.stringify(data.stats);
                    checkStrengthResultDiv.dataset.recommendations = JSON.stringify(data.recommendations);
                    updateStrengthDetails(currentLanguage);
                    checkStrengthResultDiv.style.display = 'block';
                } else {
                    alert(translations[currentLanguage].alertCheckError(data.detail));
                }
            } catch (error) {
                console.error('Errore di rete o parsing:', error);
                alert(translations[currentLanguage].alertConnectionError);
            } finally {
                toggleSpinner('checkStrengthSpinner', false);
            }
        });

        // --- Funzionalit√† Controlla Violazioni ---
        const checkBreachBtn = document.getElementById('checkBreachBtn');
        const breachPasswordInput = document.getElementById('breachPassword');
        const breachResultDiv = document.getElementById('breachResult');
        const breachMessageP = document.getElementById('breachMessage');

        breachResultDiv.style.display = 'none'; // Nascondi i risultati inizialmente

        checkBreachBtn.addEventListener('click', async () => {
            const password = breachPasswordInput.value;
            if (!password) {
                alert(translations[currentLanguage].alertEnterPasswordBreach);
                return;
            }

            toggleSpinner('checkBreachSpinner', true);
            breachResultDiv.style.display = 'none'; // Nascondi i risultati precedenti
            breachResultDiv.classList.remove('bg-red-50', 'border-red-400', 'bg-green-50', 'border-green-400', 'bg-yellow-50', 'border-yellow-400');

            try {
                const response = await fetch('/api/breach', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });

                const data = await response.json();

                if (response.ok) {
                    breachMessageP.innerText = data.message;
                    breachMessageP.dataset.originalMessage = ''; // Reset original message type
                    breachMessageP.dataset.breachCount = ''; // Reset breach count

                    if (data.is_breached) {
                        breachResultDiv.classList.add('bg-red-50', 'border-red-400');
                        breachMessageP.innerText = translations[currentLanguage].breachWarning(data.count);
                        breachMessageP.dataset.originalMessage = 'breached';
                        breachMessageP.dataset.breachCount = data.count;
                    } else if (data.count === 0) {
                        breachResultDiv.classList.add('bg-green-50', 'border-green-400');
                        breachMessageP.innerText = translations[currentLanguage].breachNotFound;
                        breachMessageP.dataset.originalMessage = 'not_breached';
                    } else { // Questo caso dovrebbe catturare il "count is None" dal backend
                        breachResultDiv.classList.add('bg-yellow-50', 'border-yellow-400');
                        breachMessageP.innerText = translations[currentLanguage].breachApiError;
                        breachMessageP.dataset.originalMessage = 'api_error';
                    }
                    breachResultDiv.style.display = 'block';
                } else {
                    // Gestisce gli errori HTTP del backend (es. 400 Bad Request)
                    breachMessageP.innerText = `Errore: ${data.detail || 'Errore sconosciuto'}`;
                    breachResultDiv.classList.add('bg-red-50', 'border-red-400');
                    breachResultDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Errore di rete o parsing:', error);
                breachMessageP.innerText = translations[currentLanguage].alertConnectionError;
                breachResultDiv.classList.add('bg-red-50', 'border-red-400');
                breachResultDiv.style.display = 'block';
            } finally {
                toggleSpinner('checkBreachSpinner', false);
            }
        });

        // Add event listeners for language buttons
        document.querySelectorAll('.lang-btn').forEach(button => {
            button.addEventListener('click', () => {
                updateLanguage(button.dataset.lang);
            });
        });

        // Attiva la prima scheda e imposta la lingua all'avvio
        document.addEventListener('DOMContentLoaded', () => {
            updateLanguage(currentLanguage); // Set initial language
            document.querySelector('.tab').click(); // Activate first tab
        });
    </script>
</body>
</html>