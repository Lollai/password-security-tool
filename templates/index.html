<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Strumento di Sicurezza Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel='stylesheet' type='text/css' href='style.css'>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-700 p-5 flex items-center justify-center">
    <div class="container">
        <div class="header rounded-t-xl">
            <div class="lang-switch">
                <span class="text-sm font-semibold">IT</span>
                <label class="switch">
                    <input type="checkbox" id="langToggle">
                    <span class="slider"></span>
                </label>
                <span class="text-sm font-semibold">EN</span>
            </div>
            <h1 class="text-4xl font-bold mb-2" data-t="title">üîê Strumento di Sicurezza Password</h1>
            <p class="text-lg opacity-90" data-t="subtitle">Genera, analizza e controlla le tue password.</p>
        </div>

        <div class="flex bg-gray-50 border-b">
            <button class="tab flex-1 py-5 px-4 font-semibold text-gray-700 hover:bg-gray-100 active" data-tab="generate" data-t="tab-gen">Genera Password</button>
            <button class="tab flex-1 py-5 px-4 font-semibold text-gray-700 hover:bg-gray-100" data-tab="strength" data-t="tab-str">Controlla Forza</button>
            <button class="tab flex-1 py-5 px-4 font-semibold text-gray-700 hover:bg-gray-100" data-tab="breach" data-t="tab-bre">Controlla Violazioni</button>
        </div>

        <!-- Generate Password Tab -->
        <div id="generate" class="tab-content active p-10">
            <h2 class="text-2xl font-bold mb-6" data-t="gen-title">Genera una Password Sicura</h2>
            <div class="space-y-4">
                <div>
                    <label class="block font-semibold mb-2" data-t="gen-length">Lunghezza (8-128):</label>
                    <input type="number" id="genLength" value="16" min="8" max="128" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none">
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="genSymbols" checked class="w-4 h-4 text-blue-600">
                    <label data-t="gen-symbols">Includi Simboli (!@#$%)</label>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="genAmbiguous" checked class="w-4 h-4 text-blue-600">
                    <label data-t="gen-ambiguous">Escludi Caratteri Ambigui (0, O, 1, l, I, |)</label>
                </div>
                <button id="genBtn" class="btn w-full py-3 text-white font-semibold rounded-lg flex items-center justify-center gap-2">
                    <span data-t="gen-btn">Genera Password</span>
                    <div id="genSpinner" class="spinner hidden"></div>
                </button>
            </div>
            <div id="genResult" class="mt-6 p-5 bg-blue-50 border-l-4 border-blue-400 rounded-lg hidden">
                <p class="font-semibold mb-2" data-t="gen-result">Password generata:</p>
                <div class="password-result">
                    <span id="genPassword"></span>
                    <button class="copy-btn" onclick="copyText('genPassword')" data-t="copy">Copia</button>
                </div>
                <p class="text-sm"><span data-t="strength">Forza:</span> <span id="genStrength"></span></p>
            </div>
        </div>

        <!-- Check Strength Tab -->
        <div id="strength" class="tab-content p-10">
            <h2 class="text-2xl font-bold mb-6" data-t="str-title">Controlla la Forza della Password</h2>
            <div class="space-y-4">
                <div>
                    <label class="block font-semibold mb-2" data-t="str-label">Inserisci password:</label>
                    <input type="password" id="strPassword" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none" data-t-placeholder="password">
                </div>
                <button id="strBtn" class="btn w-full py-3 text-white font-semibold rounded-lg flex items-center justify-center gap-2">
                    <span data-t="str-btn">Controlla Forza</span>
                    <div id="strSpinner" class="spinner hidden"></div>
                </button>
            </div>
            <div id="strResult" class="mt-6 p-5 bg-green-50 border-l-4 border-green-400 rounded-lg hidden">
                <h3 class="font-bold text-xl mb-3" data-t="str-results">Risultati:</h3>
                <p><span data-t="str-overall">Forza:</span> <span id="strLabel"></span> (<span id="strScore"></span>/100)</p>
                <div class="bg-gray-200 rounded-full h-3 mt-2">
                    <div id="strBar" class="strength-bar h-full rounded-full" style="width: 0%"></div>
                </div>
                <div class="mt-4 space-y-1 text-sm">
                    <p><span data-t="str-len">Lunghezza:</span> <span id="strLen"></span></p>
                    <p><span data-t="str-upper">Maiuscole:</span> <span id="strUpper"></span></p>
                    <p><span data-t="str-lower">Minuscole:</span> <span id="strLower"></span></p>
                    <p><span data-t="str-digits">Numeri:</span> <span id="strDigits"></span></p>
                    <p><span data-t="str-special">Simboli:</span> <span id="strSpecial"></span></p>
                    <p><span data-t="str-common">Password comune:</span> <span id="strCommon"></span></p>
                </div>
                <div class="mt-4">
                    <h4 class="font-bold mb-2" data-t="str-rec">Raccomandazioni:</h4>
                    <ul id="strRecommendations" class="list-disc pl-5 space-y-1"></ul>
                </div>
            </div>
        </div>

        <!-- Check Breach Tab -->
        <div id="breach" class="tab-content p-10">
            <h2 class="text-2xl font-bold mb-6" data-t="bre-title">Controlla Violazioni</h2>
            <div class="space-y-4">
                <div>
                    <label class="block font-semibold mb-2" data-t="bre-label">Inserisci password:</label>
                    <input type="password" id="brePassword" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none" data-t-placeholder="password">
                </div>
                <button id="breBtn" class="btn w-full py-3 text-white font-semibold rounded-lg flex items-center justify-center gap-2">
                    <span data-t="bre-btn">Controlla Password</span>
                    <div id="breSpinner" class="spinner hidden"></div>
                </button>
            </div>
            <div id="breResult" class="mt-6 p-5 rounded-lg hidden">
                <p id="breMessage" class="font-semibold"></p>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const t = {
            it: {
                title: 'üîê Strumento di Sicurezza Password',
                subtitle: 'Genera, analizza e controlla le tue password.',
                'tab-gen': 'Genera Password',
                'tab-str': 'Controlla Forza',
                'tab-bre': 'Controlla Violazioni',
                'gen-title': 'Genera una Password Sicura',
                'gen-length': 'Lunghezza (8-128):',
                'gen-symbols': 'Includi Simboli (!@#$%)',
                'gen-ambiguous': 'Escludi Caratteri Ambigui (0, O, 1, l, I, |)',
                'gen-btn': 'Genera Password',
                'gen-result': 'Password generata:',
                copy: 'Copia',
                strength: 'Forza:',
                'str-title': 'Controlla la Forza della Password',
                'str-label': 'Inserisci password:',
                password: 'La tua password',
                'str-btn': 'Controlla Forza',
                'str-results': 'Risultati:',
                'str-overall': 'Forza:',
                'str-len': 'Lunghezza:',
                'str-upper': 'Maiuscole:',
                'str-lower': 'Minuscole:',
                'str-digits': 'Numeri:',
                'str-special': 'Simboli:',
                'str-common': 'Password comune:',
                'str-rec': 'Raccomandazioni:',
                'bre-title': 'Controlla Violazioni',
                'bre-label': 'Inserisci password:',
                'bre-btn': 'Controlla Password',
                'copy-success': 'Copiato!',
                'enter-password': 'Inserisci una password',
                'network-error': 'Errore di rete',
                'yes': '‚úÖ S√¨',
                'no': '‚ùå No',
                'warning-yes': '‚ö†Ô∏è S√¨',
                'breach-safe': 'Password sicura - non trovata in violazioni',
                'breach-found': 'Password trovata in {count} violazioni. Cambiala!'
            },
            en: {
                title: 'üîê Password Security Tool',
                subtitle: 'Generate, analyze and check your passwords.',
                'tab-gen': 'Generate Password',
                'tab-str': 'Check Strength',
                'tab-bre': 'Check Breaches',
                'gen-title': 'Generate a Secure Password',
                'gen-length': 'Length (8-128):',
                'gen-symbols': 'Include Symbols (!@#$%)',
                'gen-ambiguous': 'Exclude Ambiguous Characters (0, O, 1, l, I, |)',
                'gen-btn': 'Generate Password',
                'gen-result': 'Generated password:',
                copy: 'Copy',
                strength: 'Strength:',
                'str-title': 'Check Password Strength',
                'str-label': 'Enter password:',
                password: 'Your password',
                'str-btn': 'Check Strength',
                'str-results': 'Results:',
                'str-overall': 'Strength:',
                'str-len': 'Length:',
                'str-upper': 'Uppercase:',
                'str-lower': 'Lowercase:',
                'str-digits': 'Numbers:',
                'str-special': 'Symbols:',
                'str-common': 'Common password:',
                'str-rec': 'Recommendations:',
                'bre-title': 'Check Breaches',
                'bre-label': 'Enter password:',
                'bre-btn': 'Check Password',
                'copy-success': 'Copied!',
                'enter-password': 'Enter a password',
                'network-error': 'Network error',
                'yes': '‚úÖ Yes',
                'no': '‚ùå No',
                'warning-yes': '‚ö†Ô∏è Yes',
                'breach-safe': 'Password safe - not found in breaches',
                'breach-found': 'Password found in {count} breaches. Change it!'
            }
        };

        let lang = 'it';

        // Translation function
        function translate(l) {
            document.querySelectorAll('[data-t]').forEach(el => {
                const key = el.getAttribute('data-t');
                if (t[l][key]) el.textContent = t[l][key];
            });
            document.querySelectorAll('[data-t-placeholder]').forEach(el => {
                const key = el.getAttribute('data-t-placeholder');
                if (t[l][key]) el.placeholder = t[l][key];
            });
            document.title = t[l].title;
        }

        // Language toggle
        document.getElementById('langToggle').addEventListener('change', function() {
            lang = this.checked ? 'en' : 'it';
            translate(lang);
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Copy function
        function copyText(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert(t[lang]['copy-success']);
            });
        }

        // API call helper
        async function apiCall(endpoint, data, spinnerId, resultId) {
            const spinner = document.getElementById(spinnerId);
            const result = document.getElementById(resultId);
            
            spinner.classList.remove('hidden');
            result.classList.add('hidden');
            
            try {
                const response = await fetch(`/api/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const responseData = await response.json();
                
                if (response.ok) {
                    return responseData;
                } else {
                    throw new Error(responseData.detail || 'Unknown error');
                }
            } catch (error) {
                alert(t[lang]['network-error']);
                throw error;
            } finally {
                spinner.classList.add('hidden');
            }
        }

        // Generate password
        document.getElementById('genBtn').addEventListener('click', async () => {
            const length = parseInt(document.getElementById('genLength').value);
            const includeSymbols = document.getElementById('genSymbols').checked;
            const excludeAmbiguous = document.getElementById('genAmbiguous').checked;
            
            try {
                const data = await apiCall('generate', {
                    length,
                    include_symbols: includeSymbols,
                    exclude_ambiguous: excludeAmbiguous
                }, 'genSpinner', 'genResult');
                
                document.getElementById('genPassword').textContent = data.password;
                document.getElementById('genStrength').textContent = `${data.strength_label} (${data.strength_score}/100)`;
                document.getElementById('genResult').classList.remove('hidden');
            } catch (error) {
                // Error already handled in apiCall
            }
        });

        // Check strength
        document.getElementById('strBtn').addEventListener('click', async () => {
            const password = document.getElementById('strPassword').value;
            if (!password) {
                alert(t[lang]['enter-password']);
                return;
            }
            
            try {
                const data = await apiCall('check', { password }, 'strSpinner', 'strResult');
                const stats = data.stats;
                
                document.getElementById('strLabel').textContent = stats.strength_label;
                document.getElementById('strScore').textContent = stats.strength_score;
                
                const bar = document.getElementById('strBar');
                bar.style.width = `${stats.strength_score}%`;
                bar.className = `strength-bar h-full rounded-full strength-${stats.strength_label.toLowerCase().replace(' ', '-')}`;
                
                document.getElementById('strLen').textContent = stats.length;
                document.getElementById('strUpper').innerHTML = stats.has_upper ? t[lang]['yes'] : t[lang]['no'];
                document.getElementById('strLower').innerHTML = stats.has_lower ? t[lang]['yes'] : t[lang]['no'];
                document.getElementById('strDigits').innerHTML = stats.has_digits ? t[lang]['yes'] : t[lang]['no'];
                document.getElementById('strSpecial').innerHTML = stats.has_special ? t[lang]['yes'] : t[lang]['no'];
                document.getElementById('strCommon').innerHTML = stats.is_common ? t[lang]['warning-yes'] : t[lang]['no'];
                
                const recList = document.getElementById('strRecommendations');
                recList.innerHTML = '';
                (data.recommendations || []).forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    recList.appendChild(li);
                });
                
                document.getElementById('strResult').classList.remove('hidden');
            } catch (error) {
                // Error already handled in apiCall
            }
        });

        // Check breach
        document.getElementById('breBtn').addEventListener('click', async () => {
            const password = document.getElementById('brePassword').value;
            if (!password) {
                alert(t[lang]['enter-password']);
                return;
            }
            
            try {
                const data = await apiCall('breach', { password }, 'breSpinner', 'breResult');
                const result = document.getElementById('breResult');
                const message = document.getElementById('breMessage');
                
                if (data.count === 0) {
                    message.textContent = t[lang]['breach-safe'];
                    result.className = 'mt-6 p-5 rounded-lg bg-green-50 border-l-4 border-green-400';
                } else {
                    message.textContent = t[lang]['breach-found'].replace('{count}', data.count);
                    result.className = 'mt-6 p-5 rounded-lg bg-red-50 border-l-4 border-red-400';
                }
                
                result.classList.remove('hidden');
            } catch (error) {
                // Error already handled in apiCall
            }
        });

        // Initialize
        translate(lang);
    </script>
</body>
</html>